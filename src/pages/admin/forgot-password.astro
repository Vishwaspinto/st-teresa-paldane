---
import AdminLayout from "@layouts/AdminLayout.astro";

const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
---

<AdminLayout title="Forgot Password">

  <section class="min-h-screen bg-gradient-to-br from-charcoal-950 via-charcoal-900 to-primary-900 flex items-center justify-center px-4">

    <div class="w-full max-w-md bg-white/95 backdrop-blur rounded-3xl shadow-2xl p-10 border border-white/20">

      <!-- Logo -->
      <div class="flex flex-col items-center mb-8">
        <img src="/images/logo.png" class="h-16 w-16 mb-4 rounded-full shadow-lg" />
        <h1 class="font-serif text-2xl font-semibold text-center text-charcoal-900">
          Reset Password
        </h1>
        <p class="text-sm text-gray-500 mt-1">
          Enter your admin email
        </p>
      </div>

      <form id="resetForm" class="space-y-5">

        <input
          id="email"
          type="email"
          placeholder="Email address"
          required
          class="w-full px-5 py-3 rounded-xl border border-gray-300 text-charcoal-900 focus:outline-none focus:ring-2 focus:ring-primary-600 transition"
        />

        <button
          id="submitBtn"
          type="submit"
          class="w-full py-3 rounded-xl bg-primary-600 text-white font-semibold hover:bg-primary-700 transition shadow-md"
        >
          Send Reset Link
        </button>

        <p id="message" class="text-center text-sm mt-2 min-h-[20px]"></p>

      </form>

    </div>

  </section>

  <script type="module" define:vars={{ supabaseUrl, supabaseAnonKey }}>
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    const form = document.getElementById("resetForm");
    const message = document.getElementById("message");
    const button = document.getElementById("submitBtn");

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = document.getElementById("email").value;

      if (!email) {
        message.textContent = "Please enter your email.";
        message.className = "text-red-500 text-sm text-center mt-3";
        return;
      }

      button.disabled = true;
      button.textContent = "Sending...";
      message.textContent = "";
      
      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: window.location.origin + "/admin/reset-password",
      });

      if (error) {
        message.textContent = error.message;
        message.className = "text-red-500 text-sm text-center mt-3";
        button.disabled = false;
        button.textContent = "Send Reset Link";
      } else {
        message.textContent = "Reset link sent! Check your email.";
        message.className = "text-green-600 text-sm text-center mt-3";
        button.textContent = "Email Sent âœ“";
      }
    });
  </script>

</AdminLayout>
