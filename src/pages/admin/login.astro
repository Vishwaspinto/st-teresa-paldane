---
import AdminLayout from "@layouts/AdminLayout.astro";

const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
---

<AdminLayout title="Admin Login">

  <section class="min-h-screen flex items-center justify-center px-4">

    <div class="w-full max-w-md bg-white text-charcoal-900 rounded-3xl shadow-2xl p-10">

      <!-- Logo + Name -->
      <div class="flex flex-col items-center mb-8">
        <img src="/images/logo.png" class="h-16 w-16 mb-4 rounded-full shadow-md" />
        <h1 class="font-serif text-2xl font-semibold text-center">
          St. Teresa of Kolkata
        </h1>
        <p class="text-sm text-gray-500 mt-1 tracking-wide">
          Parish Administration
        </p>
      </div>

      <form id="loginForm" class="space-y-5">

        <!-- Email -->
        <input
          id="email"
          type="email"
          placeholder="Email address"
          required
          class="w-full px-5 py-3 rounded-xl border border-gray-300 text-charcoal-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-600 transition"
        />

        <!-- Password with toggle -->
        <div class="relative">
          <input
            id="password"
            type="password"
            placeholder="Password"
            required
            class="w-full px-5 py-3 rounded-xl border border-gray-300 text-charcoal-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-600 transition"
          />
          <button
            type="button"
            id="togglePassword"
            class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-700 text-sm"
          >
            Show
          </button>
        </div>

        <!-- Login Button -->
        <button
          type="submit"
          class="w-full py-3 rounded-xl bg-primary-600 text-white font-semibold hover:bg-primary-700 transition shadow-md"
        >
          Login
        </button>

        <!-- Forgot Password -->
        <div class="text-center text-sm mt-3">
          <a href="/admin/forgot-password" class="text-primary-600 hover:underline font-medium">
            Forgot password?
          </a>
        </div>

        <p id="message" class="text-center text-sm mt-2"></p>

      </form>

    </div>

  </section>

  <script type="module" define:vars={{ supabaseUrl, supabaseAnonKey }}>
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    const form = document.getElementById("loginForm");
    const message = document.getElementById("message");
    const toggle = document.getElementById("togglePassword");
    const passwordInput = document.getElementById("password");

    // Toggle password visibility
    toggle?.addEventListener("click", () => {
      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        toggle.textContent = "Hide";
      } else {
        passwordInput.type = "password";
        toggle.textContent = "Show";
      }
    });

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = document.getElementById("email").value;
      const password = passwordInput.value;

      message.textContent = "Signing in...";
      message.className = "text-blue-500 text-sm text-center mt-2";

      const { error } = await supabase.auth.signInWithPassword({
        email,
        password,
      });

      if (error) {
        message.textContent = error.message;
        message.className = "text-red-500 text-center text-sm mt-2";
      } else {
        window.location.href = "/admin";
      }
    });
  </script>

</AdminLayout>
